;*=====================================================================*/
;*    .../prgm/project/hop/3.0.x/node_modules/tree/lib/_tree.hop       */
;*    -------------------------------------------------------------    */
;*    Author      :  Manuel Serrano                                    */
;*    Creation    :  Sun Jul  6 06:15:53 2014                          */
;*    Last change :  Mon Jul  6 14:01:09 2015 (serrano)                */
;*    Copyright   :  2014-15 Manuel Serrano                            */
;*    -------------------------------------------------------------    */
;*    TREE Hop wrapper                                                 */
;*=====================================================================*/

;*---------------------------------------------------------------------*/
;*    The module                                                       */
;*---------------------------------------------------------------------*/
(module _tree

   (library hopscript hop hopwidget nodejs)

   (export (hopscript ::JsGlobalObject ::JsObject ::JsObject ::JsObject)))

;*---------------------------------------------------------------------*/
;*    js-bind-tag! ...                                                 */
;*---------------------------------------------------------------------*/
(define-macro (js-bind-tag! %this obj tag)
   `(begin
       (js-bind! ,%this ,obj ',tag
	  :value (js-make-function ,%this
		    (lambda (this attrs . nodes)
		       (if (isa? attrs JsObject)
			   (if (null? nodes)
			       (apply ,(symbol-append '< tag '>)
				  (js-object->keyword-arguments attrs ,%this))
			       (apply ,(symbol-append '< tag '>)
				  (append
				     (js-object->keyword-arguments attrs ,%this)
				     nodes)))
			   (apply ,(symbol-append '< tag '>)
			      nodes)))
		    2 ',tag)
	  :writable #f
	  :enumerable #f)))

;*---------------------------------------------------------------------*/
;*    js-bind-tags! ...                                                */
;*---------------------------------------------------------------------*/
(define-macro (js-bind-tags! %this obj . tags)
   `(begin
       ,@(map (lambda (tag)
		 `(js-bind-tag! ,%this ,obj ,tag))
	    tags)))
   
;*---------------------------------------------------------------------*/
;*    hopscript ...                                                    */
;*---------------------------------------------------------------------*/
(define (hopscript %this this scope module)
   (let ((exports (js-get module 'exports %this)))
      (js-bind-tags! %this exports TREE TRHEAD TRBODY TRLEAF)
      (js-bind! %this exports 'close
	 :value (js-make-function %this
		   (lambda (this)
		      (cond-expand
			 (hop-server (js-undefined))
			 (else (tree-close this))))
		   0 'close)
	 :writable #f
	 :enumerable #f)
      (js-bind! %this exports 'open
	 :value (js-make-function %this
		   (lambda (this)
		      (cond-expand
			 (hop-server (js-undefined))
			 (else (tree-open this))))
		   0 'open)
	 :writable #f
	 :enumerable #f)
      (js-bind! %this exports 'toggle
	 :value (js-make-function %this
		   (lambda (this opt)
		      (cond-expand
			 (hop-server (js-undefined))
			 (else (tree-toggle this (js-totest opt)))))
		   0 'toggle)
	 :writable #f
	 :enumerable #f)
      (js-bind! %this exports 'selection
	 :value (js-make-function %this
		   (lambda (this)
		      (cond-expand
			 (hop-server (js-undefined))
			 (else (tree-selection this))))
		   0 'selection)
	 :writable #f
	 :enumerable #f)
      (js-bind! %this exports 'selectNext
	 :value (js-make-function %this
		   (lambda (this)
		      (cond-expand
			 (hop-server (js-undefined))
			 (else (tree-selectNext this))))
		   0 'selectNext)
	 :writable #f
	 :enumerable #f)
      (js-bind! %this exports 'selectPrev
	 :value (js-make-function %this
		   (lambda (this)
		      (cond-expand
			 (hop-server (js-undefined))
			 (else (tree-selectPrev this))))
		   0 'selectPrev)
	 :writable #f
	 :enumerable #f)
      (js-bind! %this exports 'selectAll
	 :value (js-make-function %this
		   (lambda (this)
		      (cond-expand
			 (hop-server (js-undefined))
			 (else (tree-selectAll this))))
		   0 'selectAll)
	 :writable #f
	 :enumerable #f)))
      
	 

