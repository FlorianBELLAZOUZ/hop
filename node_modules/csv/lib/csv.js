/*=====================================================================*/
/*    serrano/prgm/project/hop/hop/node_modules/csv/lib/csv.js         */
/*    -------------------------------------------------------------    */
/*    Author      :  Manuel Serrano                                    */
/*    Creation    :  Tue Mar 13 07:37:34 2018                          */
/*    Last change :  Wed Feb 16 07:45:05 2022 (serrano)                */
/*    Copyright   :  2018-22 Manuel Serrano                            */
/*    -------------------------------------------------------------    */
/*    XML dynamic element creation                                     */
/*=====================================================================*/
"use hopscript";

/*---------------------------------------------------------------------*/
/*    imports                                                          */
/*---------------------------------------------------------------------*/
const _load = require( "./_csv.hop" ).load;
const fs = require( "fs" );

/*---------------------------------------------------------------------*/
/*    load                                                             */
/*---------------------------------------------------------------------*/
function load(url, sep = ",", encoding = "utf8") {
   return _load(url, sep, encoding);
}

/*---------------------------------------------------------------------*/
/*    Symbol.compiler ...                                              */
/*---------------------------------------------------------------------*/
exports[ Symbol.compiler ] = (file, options) => {
   const val = _load( file, options );
   
   if( options && options.target ) {
      const fd = fs.openSync( options.target, "w" );
      try {
	 const buf = JSON.stringify( val );
	 fs.write( fd, buf, 0, buf.length );
	 
	 return {
	    type: "filename",
	    value: options.target,
	 }
      } finally {
	 fs.closeSync( options.target );
      }
   } else {
      return {
	 type: "value",
	 value: val,
      }
   }
}

/*---------------------------------------------------------------------*/
/*    exports                                                          */
/*---------------------------------------------------------------------*/
exports.load = load;
export { load };
