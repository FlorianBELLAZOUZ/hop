#*=====================================================================*/
#*    .../prgm/project/hop/3.7.x/node_modules/hop/node/Makefile        */
#*    -------------------------------------------------------------    */
#*    Author      :  manuel serrano                                    */
#*    Creation    :  Fri Oct 27 07:55:44 2023                          */
#*    Last change :  Tue Feb 13 11:02:52 2024 (serrano)                */
#*    Copyright   :  2023-24 manuel serrano                            */
#*    -------------------------------------------------------------    */
#*    Node's hop module                                                */
#*=====================================================================*/
do: build

#*---------------------------------------------------------------------*/
#*    Configuration                                                    */
#*---------------------------------------------------------------------*/
PACKAGE=hop
include ../../Makefile.modules

#*---------------------------------------------------------------------*/
#*    Goals                                                            */
#*---------------------------------------------------------------------*/
build:
	mkdir -p $(NPMDIR)/bin
	echo "#!/usr/bin/env node" > $(NPMDIR)/bin/hopc.mjs
	echo "import * as hopc from \"../lib/hopc.mjs\"" >> $(NPMDIR)/bin/hopc.mjs
	chmod a+rx $(NPMDIR)/bin/hopc.mjs
	echo "#!/usr/bin/env node" > $(NPMDIR)/bin/hopuser.mjs
	echo "import { digestPassword } from \"../lib/auth.mjs\"" >> $(NPMDIR)/bin/hopuser.mjs
	echo "console.log(JSON.stringify({name: process.argv[2], password: digestPassword(process.argv[2], process.argv[3]), services: [], directories: []}))" >> $(NPMDIR)/bin/hopuser.mjs
	chmod a+rx $(NPMDIR)/bin/hopuser.mjs
	mv $(NPMDIR)/lib/hop-client.mjs $(NPMDIR)
	cat config.mjs.in | sed -e 's|@VERSION@|$(HOPRELEASE)|' -e 's|@BUILDTAG@|$(HOPBUILDTAG)|' > $(NPMDIR)/lib/config.mjs

clean:

cleanall: clean

