#*=====================================================================*/
#*    serrano/prgm/project/hop/hop/node_modules/hop/hop/Makefile       */
#*    -------------------------------------------------------------    */
#*    Author      :  Manuel Serrano                                    */
#*    Creation    :  Fri Aug 28 10:00:50 2015                          */
#*    Last change :  Sat Jun 15 18:09:22 2024 (serrano)                */
#*    Copyright   :  2015-24 Manuel Serrano                            */
#*    -------------------------------------------------------------    */
#*    hop precompilation                                               */
#*=====================================================================*/
do: build

#*---------------------------------------------------------------------*/
#*    Configuration                                                    */
#*---------------------------------------------------------------------*/
PACKAGE=hop
SCOPE=@hop
BIGLOOEXTRAAPPLIBS=http

include ../../Makefile.modules
include ../../Makefile.scoped

#*---------------------------------------------------------------------*/
#*    The entries                                                      */
#*---------------------------------------------------------------------*/
.PHONY: build install uninstall

build: o
	$(MAKE) o/hop.$(SHAREDSUFFIX) TARGETNAME=hop OBJECTS=o/hop.o
	$(MAKE) o/_hop.$(SHAREDSUFFIX) TARGETNAME=_hop OBJECTS=o/_hop.o
	$(MAKE) o/config.$(SHAREDSUFFIX) TARGETNAME=config OBJECTS=o/config.o

npm: clean

install: mkdirs
	$(MAKE) install-so TARGETNAME=hop
	$(MAKE) install-so TARGETNAME=_hop
	$(MAKE) install-so TARGETNAME=config
	$(RM) -rf $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules/$(PACKAGE)/hop/o
	$(INSTALL) config.mjs $(INSTALLDIR)/hop && chmod $(MODFILE) $(INSTALLDIR)/hop/config.mjs
	$(INSTALL) hop.mjs $(INSTALLDIR)/hop && chmod $(MODFILE) $(INSTALLDIR)/hop/hop.mjs
	$(INSTALL) _hop.hop $(INSTALLDIR)/hop && chmod $(MODFILE) $(INSTALLDIR)/hop/_hop.hop
	$(INSTALL) ../client.mjs $(INSTALLDIR) && chmod $(MODFILE) $(INSTALLDIR)/client.mjs
	$(INSTALL) ../package.json $(INSTALLDIR) && chmod $(MODFILE) $(INSTALLDIR)/package.json
	$(INSTALL) ../type/$(PACKAGE).d.ts $(INSTALLDIR)/type && chmod $(MODFILE) $(INSTALLDIR)/type/$(PACKAGE).d.ts
	$(INSTALL) ../package.json $(INSTALLDIR) && chmod $(MODFILE) $(INSTALLDIR)/package.json
