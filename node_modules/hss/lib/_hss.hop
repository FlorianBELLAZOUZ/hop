;*=====================================================================*/
;*    serrano/prgm/project/hop/3.0.x/node_modules/hss/lib/_hss.hop     */
;*    -------------------------------------------------------------    */
;*    Author      :  Manuel Serrano                                    */
;*    Creation    :  Fri Jun 19 13:21:01 2015                          */
;*    Last change :  Wed Aug  5 07:42:05 2015 (serrano)                */
;*    Copyright   :  2015 Manuel Serrano                               */
;*    -------------------------------------------------------------    */
;*    Hop hss manager                                                 */
;*=====================================================================*/

;*---------------------------------------------------------------------*/
;*    The module                                                       */
;*---------------------------------------------------------------------*/
(module _hss
   
   (library hopscript hop hopwidget nodejs)
   
   (export (hopscript ::JsGlobalObject ::JsObject ::JsObject ::JsObject)))
	   
;*---------------------------------------------------------------------*/
;*    define-js ...                                                    */
;*---------------------------------------------------------------------*/
(define-macro (define-js name arity proc . opt)
   `(cons ',name
       (js-make-function %this ,proc ,arity ,(symbol->string name) ,@opt)))
		 
;*---------------------------------------------------------------------*/
;*    hopscript ...                                                    */
;*---------------------------------------------------------------------*/
(define (hopscript %this this scope module)
   
   (let ((exports (js-get module 'exports %this)))
      
      (define-js parseWebColor 1
	 (lambda (this color)
	    (hopjs-parse-web-color (js-tostring color %this) %this)))
      
      (define-js makeWebColor 3 
	 (lambda (this r g b)
	    (js-string->jsstring (make-hex-color r g b))))))

;*---------------------------------------------------------------------*/
;*    hopjs-parse-web-color ...                                        */
;*---------------------------------------------------------------------*/
(define (hopjs-parse-web-color color %this)
   (with-access::JsGlobalObject %this (js-object)
      (multiple-value-bind (r g b)
	 (parse-web-color color)
	 (let ((obj (js-new %this js-object)))
	    (js-put! obj 'red r #f %this)
	    (js-put! obj 'green g #f %this)
	    (js-put! obj 'blue b #f %this)
	    obj))))

