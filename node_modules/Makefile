#*=====================================================================*/
#*    serrano/prgm/project/hop/3.0.x/node_modules/Makefile             */
#*    -------------------------------------------------------------    */
#*    Author      :  Manuel Serrano                                    */
#*    Creation    :  Fri Jan 20 13:46:40 2006                          */
#*    Last change :  Fri Jul 31 16:17:56 2015 (serrano)                */
#*    Copyright   :  2006-15 Manuel Serrano                            */
#*    -------------------------------------------------------------    */
#*    ETC Makefile                                                     */
#*=====================================================================*/
do: build

#*---------------------------------------------------------------------*/
#*    Configuration                                                    */
#*---------------------------------------------------------------------*/
-include ../etc/Makefile.hopconfig
-include ../etc/Makefile.version

#*---------------------------------------------------------------------*/
#*    Population                                                       */
#*---------------------------------------------------------------------*/
POPULATION = Makefile mkjsast.scm \
	hopc/package.json hopc/lib/hopc.js \
	tree/package.json tree/lib/tree.js tree/lib/_tree.hop tree/doc/tree.md \
	notepad/package.json notepad/lib/notepad.js notepad/lib/_notepad.hop \
	spage/package.json spage/lib/spage.js spage/lib/_spage.hop \
        fontifier/package.json fontifier/lib/fontifier.js \
        fontifier/lib/_fontifier.hop fontifier/hss/fontifier.hss \
        wiki/package.json wiki/lib/wiki.js wiki/lib/_wiki.hop \
        security/package.json security/lib/security.js security/lib/_security.hop \
        config/package.json config/lib/config.js config/lib/_config.hop \
        user/package.json user/lib/user.js user/lib/_user.hop \
        hopdoc/package.json hopdoc/lib/hopdoc.js hopdoc/lib/_hopdoc.hop \
        hopdoc/hss/hopdoc.hss \
        hopdoc/lib/bootstrap/css/bootstrap-theme.css \
        hopdoc/lib/bootstrap/css/bootstrap-theme.css.map \
        hopdoc/lib/bootstrap/css/bootstrap-theme.min.css \
        hopdoc/lib/bootstrap/css/bootstrap.css \
        hopdoc/lib/bootstrap/css/bootstrap.css.map \
        hopdoc/lib/bootstrap/css/bootstrap.min.css \
        hopdoc/lib/bootstrap/fonts/glyphicons-halflings-regular.eot \
        hopdoc/lib/bootstrap/fonts/glyphicons-halflings-regular.svg \
        hopdoc/lib/bootstrap/fonts/glyphicons-halflings-regular.ttf \
        hopdoc/lib/bootstrap/fonts/glyphicons-halflings-regular.woff \
        hopdoc/lib/bootstrap/fonts/glyphicons-halflings-regular.woff2 \
        hopdoc/lib/bootstrap/js/bootstrap.js \
        hopdoc/lib/bootstrap/js/bootstrap.min.js \
        hopdoc/lib/bootstrap/js/npm.js \
        hopdoc/lib/jquery/js/jquery.min.js \
        markdown/package.json markdown/lib/markdown.js \
        markdown/lib/_markdown.hop markdown/lib/md.hop markdown/hss/markdown.hss \
        markdown/lib/token.sch

#*---------------------------------------------------------------------*/
#*    The hop executable                                               */
#*---------------------------------------------------------------------*/
.PHONY: build clean install uninstall

build: hopc/lib/walk.js hopc/lib/ast.js \
  markdown/lib/.afile

#*---------------------------------------------------------------------*/
#*    clean                                                            */
#*---------------------------------------------------------------------*/
clean:
	$(RM) -f hopc/lib/walk.js
	$(RM) -f hopc/lib/ast.js

devclean: clean

distclean: clean

#*---------------------------------------------------------------------*/
#*    install                                                          */
#*---------------------------------------------------------------------*/
install:
	mkdir -p $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	cp -r ../node_modules/hopc $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	cp -r ../node_modules/tree $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	cp -r ../node_modules/notepad $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	cp -r ../node_modules/spage $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	cp -r ../node_modules/fontifier $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	cp -r ../node_modules/wiki $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	cp -r ../node_modules/security $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	cp -r ../node_modules/config $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	cp -r ../node_modules/user $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	cp -r ../node_modules/hopdoc $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	cp -r ../node_modules/markdown $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	chmod -R $(MODDIR) $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules

uninstall:
	-$(RM) -rf $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules

#*---------------------------------------------------------------------*/
#*    walk.js ...                                                      */
#*---------------------------------------------------------------------*/
hopc/lib/walk.js: ../js2scheme/ast.scm
	date +'/* generated file, do not edit (%d %B %Y) */' > $@
	echo "" >> $@
	echo "var ast = require( './ast.js' );" >> $@
	echo "" >> $@
	echo "" >> $@
	(cd $(BUILDDIR)/js2scheme; $(BIGLOO) -srfi generate-javascript-walker -expand -o /dev/null ../js2scheme/ast.scm) >> $@

#*---------------------------------------------------------------------*/
#*    ast.js                                                           */
#*---------------------------------------------------------------------*/
hopc/lib/ast.js: ../js2scheme/ast.scm mkjsast.scm
	date +'/* generated file, do not edit (%d %B %Y) */' > $@
	echo "" >> $@
	$(BIGLOO) -i mkjsast.scm ../js2scheme/ast >> $@

#*---------------------------------------------------------------------*/
#*    markdown/lib/.afile ...                                          */
#*---------------------------------------------------------------------*/
markdown/lib/.afile:  markdown/lib/_markdown.hop markdown/lib/md.hop
	(cd $(dir $@) && $(AFILE) -suffix hop $(notdir $^) -o $(notdir $@))
