#*=====================================================================*/
#*    serrano/prgm/project/hop/hop/node_modules/Makefile               */
#*    -------------------------------------------------------------    */
#*    Author      :  Manuel Serrano                                    */
#*    Creation    :  Fri Jan 20 13:46:40 2006                          */
#*    Last change :  Sat Nov 26 11:51:37 2022 (serrano)                */
#*    Copyright   :  2006-22 Manuel Serrano                            */
#*    -------------------------------------------------------------    */
#*    node_modules Makefile                                            */
#*=====================================================================*/
do: build

#*---------------------------------------------------------------------*/
#*    Configuration                                                    */
#*---------------------------------------------------------------------*/
-include ../etc/Makefile.hopconfig
-include ../etc/Makefile.version

#*---------------------------------------------------------------------*/
#*    Population                                                       */
#*---------------------------------------------------------------------*/
POPULATION = Makefile Makefile.modules mkjsast.scm \
	hopc/package.json hopc/lib/hopc.js hopc/lib/_compiler.hop \
        hopscript/package.json hopscript/lib/hopscript.js \
	tree/package.json tree/lib/tree.js tree/lib/_tree.hop tree/doc/tree.md \
	notepad/package.json notepad/lib/notepad.js notepad/lib/_notepad.hop \
	spage/package.json spage/lib/spage.js spage/lib/_spage.hop spage/doc/spage.md\
        fontifier/package.json fontifier/lib/fontifier.js \
        fontifier/lib/_fontifier.hop fontifier/hss/fontifier.hss \
        fontifier/lib/Makefile \
        wiki/package.json wiki/lib/wiki.js wiki/lib/_wiki.hop \
        security/package.json security/lib/security.js security/lib/_security.hop \
        config/package.json config/lib/config.js config/lib/_config.hop \
        config/lib/Makefile config/doc/config.md \
        user/package.json user/lib/user.js user/lib/_user.hop user/doc/user.md \
        hss/package.json hss/lib/hss.js hss/lib/_hss.hop hss/doc/hss.md \
        hopdoc/package.json hopdoc/lib/hopdoc.js hopdoc/lib/_hopdoc.hop \
        hopdoc/lib/xml-ignore.json \
        markdown/package.json markdown/lib/markdown.js \
        markdown/lib/_markdown.hop markdown/lib/md.hop markdown/hss/markdown.hss \
        markdown/lib/token.sch markdown/doc/markdown.md markdown/lib/Makefile \
        texinfo/package.json texinfo/lib/texinfo.js \
        texinfo/lib/_texinfo.hop texinfo/hss/texinfo.hss \
        texinfo/doc/texinfo.md texinfo/lib/Makefile \
        hopdroid/package.json hopdroid/lib/hopdroid.js \
        hopdroid/lib/_hopdroid.hop \
        hopdroid/doc/hopdroid.md hopdroid/lib/Makefile \
        syslog/package.json syslog/lib/syslog.js syslog/lib/_syslog.hop \
        syslog/lib/Makefile syslog/doc/syslog.md \
        system/package.json system/lib/system.js system/lib/_system.hop \
        system/lib/system.d.ts system/lib/Makefile system/doc/system.md \
        utils/package.json utils/lib/utils.js utils/lib/_utils.hop \
        utils/lib/Makefile utils/doc/utils.md \
        systime/package.json systime/lib/systime.js systime/lib/_systime.hop \
        systime/lib/Makefile systime/doc/systime.md \
        cpp/package.json cpp/lib/Makefile cpp/lib/cpp.js cpp/lib/cpp.json \
        cpp/lib/cpprc.json cpp/doc/cpp.md cpp/doc/example.js cpp/doc/op.js \
        feed/package.json feed/lib/Makefile feed/lib/feed.js feed/lib/feed.json \
        feed/doc/feed.md \
        xml/package.json xml/lib/Makefile xml/lib/xml.js xml/lib/xml.json \
        xml/lib/xml.d.ts xml/doc/xml.md \
        csv/package.json csv/lib/Makefile csv/lib/csv.js csv/lib/csv.json \
        csv/doc/csv.md \
        text/package.json text/lib/Makefile text/lib/text.js \
        text/lib/text.json text/doc/text.md \
        hz/package.json hz/lib/Makefile hz/lib/hz.js \
        hz/lib/hz.json hz/doc/hz.md \
        ts/package.json ts/lib/Makefile ts/lib/ts.js ts/lib/ts.json \
        ts/lib/tsrc.json ts/ ts/doc/ts.md \
        vcf/package.json vcf/lib/Makefile vcf/lib/vcf.js vcf/lib/vcf.json \
        vcf/lib/_vcf.js vcf/lib/_bbdb.js vcf/doc/vcf.md \
        openpgp/package.json openpgp/lib/Makefile openpgp/lib/openpgp.js \
        openpgp/lib/_openpgp.js openpgp/lib/openpgp.json \
        openpgp/doc/openpgp.md openpgp/doc/readkeys.js \
        openpgp/doc/sign.js openpgp/doc/verify.js \
        openpgp/doc/encrypt.js openpgp/doc/encrypta.js \
        openpgp/doc/example.pkey openpgp/doc/example.skey \
        zeroconf/package.json zeroconf/lib/Makefile zeroconf/lib/zeroconf.js \
        zeroconf/lib/zeroconf.json zeroconf/doc/zeroconf.md \
        exif/package.json exif/lib/exif.js exif/lib/_exif.hop \
        exif/lib/Makefile exif/doc/exif.md \
        @types/hop.d.ts @types/node/assert.d.ts @types/node/http2.d.ts \
        @types/node/repl.d.ts @types/node/async_hooks.d.ts \
        @types/node/http.d.ts \
        @types/node/stream.d.ts @types/node/base.d.ts @types/node/https.d.ts \
        @types/node/string_decoder.d.ts @types/node/buffer.d.ts \
        @types/node/index.d.ts @types/node/timers.d.ts \
	@types/node/child_process.d.ts @types/node/inspector.d.ts \
        @types/node/tls.d.ts @types/node/cluster.d.ts \
        @types/node/trace_events.d.ts @types/node/console.d.ts \
        @types/node/module.d.ts @types/node/ts3.6/assert.d.ts \
        @types/node/ts3.6/base.d.ts @types/node/ts3.6/index.d.ts \
	@types/node/constants.d.ts @types/node/net.d.ts @types/node/tty.d.ts \
	@types/node/crypto.d.ts @types/node/os.d.ts @types/node/url.d.ts \
	@types/node/dgram.d.ts @types/node/package.json @types/node/util.d.ts \
	@types/node/dns.d.ts @types/node/path.d.ts @types/node/v8.d.ts \
	@types/node/domain.d.ts @types/node/perf_hooks.d.ts \
        @types/node/vm.d.ts @types/node/events.d.ts @types/node/process.d.ts \
        @types/node/wasi.d.ts @types/node/fs/promises.d.ts \
        @types/node/punycode.d.ts @types/node/worker_threads.d.ts \
	@types/node/fs.d.ts @types/node/querystring.d.ts @types/node/zlib.d.ts \
	@types/node/globals.d.ts @types/node/readline.d.ts \
        @types/node/globals.global.d.ts

#*---------------------------------------------------------------------*/
#*    The entries                                                      */
#*---------------------------------------------------------------------*/
.PHONY: build clean install uninstall

build: hopc/lib/walk.js hopc/lib/ast.js
	$(MAKE) -C markdown/lib build
	$(MAKE) -C texinfo/lib build
	$(MAKE) -C fontifier/lib build
	$(MAKE) -C config/lib build
	$(MAKE) -C syslog/lib build
	$(MAKE) -C hopc/lib build
	$(MAKE) -C hopscript/lib build
	$(MAKE) -C openpgp/lib build
	$(MAKE) -C systime/lib build
	$(MAKE) -C system/lib build
	$(MAKE) -C cpp/lib build
	$(MAKE) -C feed/lib build
	$(MAKE) -C tree/lib build
	$(MAKE) -C xml/lib build
	$(MAKE) -C csv/lib build
	$(MAKE) -C text/lib build
	$(MAKE) -C hz/lib build
	$(MAKE) -C ts/lib build
	$(MAKE) -C utils/lib build
	$(MAKE) -C vcf/lib build
	$(MAKE) -C hopdroid/lib build
	$(MAKE) -C zeroconf/lib build
	$(MAKE) -C exif/lib build

#*---------------------------------------------------------------------*/
#*    install                                                          */
#*---------------------------------------------------------------------*/
install:
	$(MAKE) mkdir DIR=$(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	$(MAKE) mkdir DIR=$(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules/@hop
	cp -r ../node_modules/notepad $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	cp -r ../node_modules/spage $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	cp -r ../node_modules/wiki $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	cp -r ../node_modules/security $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	cp -r ../node_modules/config $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	cp -r ../node_modules/user $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	cp -r ../node_modules/hopdoc $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	cp -r ../node_modules/hss $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	cp -r ../node_modules/@types $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules
	$(MAKE) -C markdown/lib install
	$(MAKE) -C texinfo/lib install
	$(MAKE) -C fontifier/lib install
	$(MAKE) -C config/lib install
	$(MAKE) -C syslog/lib install
	$(MAKE) -C hopc/lib install
	$(MAKE) -C hopscript/lib install
	$(MAKE) -C openpgp/lib install
	$(MAKE) -C systime/lib install
	$(MAKE) -C system/lib install
	$(MAKE) -C cpp/lib install
	$(MAKE) -C feed/lib install
	$(MAKE) -C tree/lib install
	$(MAKE) -C xml/lib install
	$(MAKE) -C csv/lib install
	$(MAKE) -C text/lib install
	$(MAKE) -C hz/lib install
	$(MAKE) -C ts/lib install
	$(MAKE) -C utils/lib install
	$(MAKE) -C vcf/lib install
	$(MAKE) -C hopdroid/lib install
	$(MAKE) -C zeroconf/lib install
	$(MAKE) -C exif/lib install
	chmod -R $(MODDIR) $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules

uninstall:
	-$(RM) -rf $(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR)/node_modules

#*---------------------------------------------------------------------*/
#*    walk.js ...                                                      */
#*---------------------------------------------------------------------*/
hopc/lib/walk.js: ../js2scheme/ast.scm
	date +'/* generated file, do not edit (%d %B %Y) */' > $@
	echo "" >> $@
	echo "var ast = require( './ast.js' );" >> $@
	echo "" >> $@
	echo "" >> $@
	(cd $(BUILDDIR)/js2scheme; $(BIGLOO) -srfi generate-javascript-walker -expand -o /dev/null ../js2scheme/ast.scm) >> $@

#*---------------------------------------------------------------------*/
#*    ast.js                                                           */
#*---------------------------------------------------------------------*/
hopc/lib/ast.js: ../js2scheme/ast.scm mkjsast.scm
	date +'/* generated file, do not edit (%d %B %Y) */' > $@
	echo "" >> $@
	$(BIGLOO) -i mkjsast.scm ../js2scheme/ast >> $@

#*---------------------------------------------------------------------*/
#*    clean                                                            */
#*---------------------------------------------------------------------*/
clean:
	$(RM) -f hopc/lib/walk.js
	$(RM) -f hopc/lib/ast.js
	$(MAKE) -C markdown/lib clean
	$(MAKE) -C texinfo/lib clean
	$(MAKE) -C fontifier/lib clean
	$(MAKE) -C config/lib clean
	$(MAKE) -C syslog/lib clean
	$(MAKE) -C hopc/lib clean
	$(MAKE) -C hopscript/lib clean
	$(MAKE) -C openpgp/lib clean
	$(MAKE) -C systime/lib clean
	$(MAKE) -C system/lib clean
	$(MAKE) -C cpp/lib clean
	$(MAKE) -C feed/lib clean
	$(MAKE) -C tree/lib clean
	$(MAKE) -C xml/lib clean
	$(MAKE) -C csv/lib clean
	$(MAKE) -C text/lib clean
	$(MAKE) -C hz/lib clean
	$(MAKE) -C ts/lib clean
	$(MAKE) -C utils/lib clean
	$(MAKE) -C vcf/lib clean
	$(MAKE) -C hopdroid/lib clean
	$(MAKE) -C zeroconf/lib clean
	$(MAKE) -C exif/lib clean

devclean: clean

distclean: clean

