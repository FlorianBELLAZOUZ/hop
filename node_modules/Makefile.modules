#*=====================================================================*/
#*    serrano/prgm/project/hop/hop/node_modules/Makefile.modules       */
#*    -------------------------------------------------------------    */
#*    Author      :  Manuel Serrano                                    */
#*    Creation    :  Fri Oct 20 07:47:22 2017                          */
#*    Last change :  Wed May  8 07:57:06 2024 (serrano)                */
#*    Copyright   :  2017-24 Manuel Serrano                            */
#*    -------------------------------------------------------------    */
#*    Common Makefile to build nodejs_modules                          */
#*=====================================================================*/

#*---------------------------------------------------------------------*/
#*    Configuration                                                    */
#*---------------------------------------------------------------------*/
-include ../../../etc/Makefile.hopconfig
-include ../../../etc/Makefile.version
-include $(BIGLOOLIBDIR)/Makefile.config
-include $(BIGLOOLIBDIR)/Makefile.misc

RPATH += $(HOPLIBDIR)/$(HOPFILDIR)

DIR = node_modules/$(PACKAGE)/lib
LIBSDIR = hop/$(HOPRELEASE)/$(DIR)/so/$(HOPRELEASE)/$(HOPBUILDID)/$(MACH)
HOPAPPLIBS = js2scheme hop hopscript nodejs
APPRELEASE = $(HOPRELEASE)

shared-lib:
	if [ "$(THREADS)" = "yes" ]; then \
          $(MAKE) bigloo-shared-lib \
               LIBSUFFIXTHREAD=_mt \
               LDINSTALLNAMEDIR=$(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR) \
               BIGLOOEXTRALIBS="$(HOPBIGLOOEXTRALIBS)" \
               BIGLOOAPPLIBS="$(HOPAPPLIBS) $(BIGLOOEXTRAAPPLIBS)"; \
        else \
          $(MAKE) bigloo-shared-lib \
               LIBSUFFIXTHREAD= \
               LDINSTALLNAMEDIR=$(DESTDIR)$(HOPLIBDIR)/$(HOPFILDIR) \
               LDOPTS="-L$(BUILDLIBDIR) $(LDHOPOPTS) $(LDOPTS)" \
               BIGLOOEXTRALIBS="$(HOPBIGLOOEXTRALIBS)" \
               BIGLOOAPPLIBS="$(HOPAPPLIBS) $(BIGLOOEXTRAAPPLIBS)"; \
        fi

